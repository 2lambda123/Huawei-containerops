*** Keywords ***
createNewComponent
    [Arguments]    ${url}    ${namespace}    ${body}    ${message}    ${statuscode}
    Create Session    session    ${url}
    ${resp}=    Post Request    session    /pipeline/v1/${namespace}/component    ${body}
    log    ${resp.status_code}
    log    ${resp.content}
    Should Be Equal As Strings    ${resp.status_code}    ${statuscode}
    ${json}=    To JSON    ${resp.content}
    log    ${json}
    Dictionary Should Contain Value    ${json}    ${message}
    ${values}    Get Dictionary Values    ${json}
    log    ${values}
    Delete All Sessions

getComponentList
    [Arguments]    ${url}    ${namespace}    ${statuscode}    ${message}
    Create Session    session    ${url}
    ${resp}=    Get Request    session    /pipeline/v1/${namespace}/component
    log    ${resp.status_code}
    log    ${resp.content}
    Should Be Equal As Strings    ${resp.status_code}    ${statuscode}
    Should Contain    ${resp.content}    ${message}
    ${json}    To JSON    ${resp.content}
    ${componentID}    Set Variable    ${json['list'][0]['id']}
    ${componentName}    Set Variable    ${json['list'][0]['name']}
    Delete All Sessions
    [Return]    ${componentID}    ${componentName}

getComponentInfo
    [Arguments]    ${url}    ${namespace}    ${statuscode}    ${componentName}    ${componentID}    ${message}
    Create Session    session    ${url}
    ${resp}=    Get Request    session    /pipeline/v1/${namespace}/component/${componentName}?id=${componentID}
    log    ${resp.status_code}
    log    ${resp.content}
    Should Be Equal As Strings    ${resp.status_code}    ${statuscode}
    Should Contain    ${resp.content}    ${message}
    ${json}    To JSON    ${resp.content}
    log    ${json}
    Delete All Sessions

saveComponent
    [Arguments]    ${url}    ${namespace}    ${body}    ${message}    ${statuscode}    ${componentName}
    Create Session    session    ${url}
    ${resp}=    Put Request    session    /pipeline/v1/${namespace}/component/${componentName}    ${body}
    log    ${resp.status_code}
    log    ${resp.content}
    Should Be Equal As Strings    ${resp.status_code}    ${statuscode}
    ${json}=    To JSON    ${resp.content}
    log    ${json}
    Dictionary Should Contain Value    ${json}    ${message}
    ${values}    Get Dictionary Values    ${json}
    log    ${values}
    Delete All Sessions

createNewWorkflow
    [Arguments]    ${url}    ${namespace}    ${repository}    ${body}    ${message}    ${statuscode}
    Create Session    session    ${url}
    ${resp}=    Post Request    session    /pipeline/v1/${namespace}/${repository}    ${body}
    log    ${resp.status_code}
    log    ${resp.content}
    Should Be Equal As Strings    ${resp.status_code}    ${statuscode}
    ${json}=    To JSON    ${resp.content}
    log    ${json}
    Dictionary Should Contain Value    ${json}    ${message}
    ${values}    Get Dictionary Values    ${json}
    log    ${values}
    Delete All Sessions

getWorkflowList
    [Arguments]    ${url}    ${namespace}    ${repository}    ${statuscode}
    Create Session    session    ${url}
    ${resp}=    Get Request    session    /pipeline/v1/${namespace}/${repository}
    log    ${resp.status_code}
    log    ${resp.content}
    Should Be Equal As Strings    ${resp.status_code}    ${statuscode}
    Should Contain    ${resp.content}    id
    Should Contain    ${resp.content}    name
    ${json}    To JSON    ${resp.content}
    Delete All Sessions
    [Return]    ${json['list'][0]['id']}    ${json['list'][0]['name']}

getWorkflowInfo
    [Arguments]    ${url}    ${namespace}    ${repository}    ${statuscode}    ${pipelineID}    ${pipelineName}
    ...    ${message}
    Create Session    session    ${url}
    ${resp}=    Get Request    session    /pipeline/v1/${namespace}/${repository}/${pipelineName}/json?id=${pipelineID}
    log    ${resp.status_code}
    log    ${resp.content}
    Should Be Equal As Strings    ${resp.status_code}    ${statuscode}
    Should Contain    ${resp.content}    ${message}
    ${json}    To JSON    ${resp.content}
    log    ${json}
    Delete All Sessions

saveWorkflow
    [Arguments]    ${url}    ${namespace}    ${repository}    ${body}    ${message}    ${statuscode}
    ...    ${pipelineName}
    Create Session    session    ${url}
    ${resp}=    Put Request    session    /pipeline/v1/${namespace}/${repository}/${pipelineName}    ${body}
    log    ${resp.status_code}
    log    ${resp.content}
    Should Be Equal As Strings    ${resp.status_code}    ${statuscode}
    ${json}=    To JSON    ${resp.content}
    log    ${json}
    Dictionary Should Contain Value    ${json}    ${message}
    ${values}    Get Dictionary Values    ${json}
    log    ${values}
    Delete All Sessions

setWorkflowEnv
    [Arguments]    ${url}    ${namespace}    ${repository}    ${body}    ${message}    ${statuscode}
    ...    ${pipelineName}
    Create Session    session    ${url}
    ${resp}=    Put Request    session    /pipeline/v1/${namespace}/${repository}/${pipelineName}/env    ${body}
    log    ${resp.status_code}
    log    ${resp.content}
    Should Be Equal As Strings    ${resp.status_code}    ${statuscode}
    ${json}=    To JSON    ${resp.content}
    log    ${json}
    Dictionary Should Contain Value    ${json}    ${message}
    ${values}    Get Dictionary Values    ${json}
    log    ${values}
    Delete All Sessions

getWorkflowEnv
    [Arguments]    ${url}    ${namespace}    ${repository}    ${message}    ${statuscode}    ${pipelineID}
    ...    ${pipelineName}
    Create Session    session    ${url}
    ${resp}=    Get Request    session    /pipeline/v1/${namespace}/${repository}/${pipelineName}/env?id=${pipelineID}
    log    ${resp.status_code}
    log    ${resp.content}
    Should Be Equal As Strings    ${resp.status_code}    ${statuscode}
    Should Contain    ${resp.content}    ${message}
    ${json}    To JSON    ${resp.content}
    log    ${json}
    Delete All Sessions

modifyWorkflowStatus
    [Arguments]    ${url}    ${namespace}    ${repository}    ${body}    ${message}    ${statuscode}
    ...    ${pipelineName}
    Create Session    session    ${url}
    ${resp}=    Put Request    session    /pipeline/v1/${namespace}/${repository}/${pipelineName}/state    ${body}
    log    ${resp.status_code}
    log    ${resp.content}
    Should Be Equal As Strings    ${resp.status_code}    ${statuscode}
    Should Contain    ${resp.content}    ${message}
    ${json}    To JSON    ${resp.content}
    log    ${json}
    Delete All Sessions

runWorkflow
    [Arguments]    ${url}    ${namespace}    ${repository}    ${body}    ${message}    ${statuscode}
    ...    ${pipelineName}
    Create Session    session    ${url}
    ${resp}=    Post Request    session    /pipeline/v1/${namespace}/${repository}/${pipelineName}    ${body}
    log    ${resp.status_code}
    log    ${resp.content}
    Should Be Equal As Strings    ${resp.status_code}    ${statuscode}
    ${json}=    To JSON    ${resp.content}
    log    ${json}
    Dictionary Should Contain Value    ${json}    ${message}
    ${values}    Get Dictionary Values    ${json}
    log    ${values}
    Delete All Sessions

getWorkflowHistoryList
    [Arguments]    ${url}    ${namespace}    ${repository}    ${message}    ${statuscode}
    Create Session    session    ${url}
    ${resp}=    Get Request    session    /pipeline/v1/${namespace}/${repository}/histories
    log    ${resp.status_code}
    log    ${resp.content}
    Should Be Equal As Strings    ${resp.status_code}    ${statuscode}
    Should Contain    ${resp.content}    ${message}
    ${json}    To JSON    ${resp.content}
    log    ${json}
    log    ${json['pipelineList'][0]['versionList'][0]['sequenceList'][0]['pipelineSequenceID']}
    Delete All Sessions
    [Return]    ${json['pipelineList'][0]['versionList'][0]['sequenceList'][0]['pipelineSequenceID']}

getWorkflowHistory
    [Arguments]    ${url}    ${namespace}    ${repository}    ${statuscode}    ${pipelineID}    ${pipelineName}
    ...    ${message}    ${sequenceId}
    Create Session    session    ${url}
    ${resp}=    Get Request    session    /pipeline/v1/${namespace}/${repository}/${pipelineName}/historyDefine?versionId=${pipelineID}&sequenceId=${sequenceId}
    log    ${resp.status_code}
    log    ${resp.content}
    Should Be Equal As Strings    ${resp.status_code}    ${statuscode}
    Should Contain    ${resp.content}    ${message}
    ${json}    To JSON    ${resp.content}
    log    ${json}
    log    ${json['define']['lineList'][0]['endData']['id']}
    log    ${json['define']['stageList'][0]['id']}
    Delete All Sessions
    [Return]    ${json['define']['lineList'][0]['endData']['id']}    ${json['define']['stageList'][0]['id']}

getGithubEventJson
    [Arguments]    ${url}    ${statuscode}    ${eventName}    ${message}
    Create Session    session    ${url}
    ${resp}=    Get Request    session    /pipeline/v1/eventJson/github/${eventName}
    log    ${resp.status_code}
    log    ${resp.content}
    Should Be Equal As Strings    ${resp.status_code}    ${statuscode}
    Should Contain    ${resp.content}    ${message}
    ${json}    To JSON    ${resp.content}
    log    ${json}
    Delete All Sessions

getWorkflowTokenAndUrl
    [Arguments]    ${url}    ${namespace}    ${repository}    ${message}    ${statuscode}    ${pipelineID}
    ...    ${pipelineName}
    Create Session    session    ${url}
    ${resp}=    Get Request    session    /pipeline/v1/${namespace}/${repository}/${pipelineName}/token?id=${pipelineID}
    log    ${resp.status_code}
    log    ${resp.content}
    Should Be Equal As Strings    ${resp.status_code}    ${statuscode}
    Should Contain    ${resp.content}    ${message}
    ${json}    To JSON    ${resp.content}
    log    ${json}
    Delete All Sessions

getWorkflowActionRunHistory
    [Arguments]    ${url}    ${namespace}    ${repository}    ${message}    ${statuscode}    ${pipelineName}
    ...    ${stageName}    ${actionName}    ${actionLogID}
    Create Session    session    ${url}
    ${resp}=    Get Request    session    /pipeline/v1/${namespace}/${repository}/${pipelineName}/stage/${stageName}/${actionName}/history?actionLogId=${actionLogID}
    log    ${resp.status_code}
    log    ${resp.content}
    Should Be Equal As Strings    ${resp.status_code}    ${statuscode}
    Should Contain    ${resp.content}    ${message}
    ${json}    To JSON    ${resp.content}
    log    ${json}
    Delete All Sessions

getWorkflowActionRelationInfo
    [Arguments]    ${url}    ${namespace}    ${repository}    ${message}    ${statuscode}    ${pipelineSequenceID}
    ...    ${pipelineName}    ${startActionId}    ${endActionId}
    Create Session    session    ${url}
    ${resp}=    Get Request    session    /pipeline/v1/${namespace}/${repository}/${pipelineName}/${pipelineSequenceID}/lineHistory?startActionId=${startActionId}&endActionId=${endActionId}
    log    ${resp.status_code}
    log    ${resp.content}
    Should Be Equal As Strings    ${resp.status_code}    ${statuscode}
    Should Contain    ${resp.content}    ${message}
    ${json}    To JSON    ${resp.content}
    log    ${json}
    Delete All Sessions

getWorkflowExceptList
    [Arguments]    ${url}    ${namespace}    ${repository}    ${statuscode}    ${message}
    Create Session    session    ${url}
    ${resp}=    Get Request    session    /pipeline/v1/${namespace}/${repository}
    log    ${resp.status_code}
    log    ${resp.content}
    Should Be Equal As Strings    ${resp.status_code}    ${statuscode}
    Should Contain    ${resp.content}    ${message}
    Delete All Sessions

componentOps
    [Arguments]    ${url}    ${namespace}    ${repository}    ${body}    ${message}    ${statuscode}
    ...    ${componentName}
    Create Session    session    ${url}
    ${resp}=    Put Request    session    /pipeline/v1/${namespace}/${repository}/${componentName}/event    ${body}
    log    ${resp.status_code}
    log    ${resp.content}
    Should Be Equal As Strings    ${resp.status_code}    ${statuscode}
    ${json}=    To JSON    ${resp.content}
    log    ${json}
    #Dictionary Should Contain Value    ${json}    ${message}
    ${values}    Get Dictionary Values    ${json}
    log    ${values}
    Delete All Sessions

componentReg
    [Arguments]    ${url}    ${namespace}    ${repository}    ${body}    ${message}    ${statuscode}
    ...    ${componentName}
    Create Session    session    ${url}
    ${resp}=    Put Request    session    /pipeline/v1/${namespace}/${repository}/${componentName}/register    ${body}
    log    ${resp.status_code}
    log    ${resp.content}
    Should Be Equal As Strings    ${resp.status_code}    ${statuscode}
    ${json}=    To JSON    ${resp.content}
    log    ${json}
    Dictionary Should Contain Value    ${json}    ${message}
    ${values}    Get Dictionary Values    ${json}
    log    ${values}
    Delete All Sessions

getComponentExceptList
    [Arguments]    ${url}    ${namespace}    ${statuscode}    ${message}
    Create Session    session    ${url}
    ${resp}=    Get Request    session    /pipeline/v1/${namespace}/component
    log    ${resp.status_code}
    log    ${resp.content}
    Should Be Equal As Strings    ${resp.status_code}    ${statuscode}
    Should Contain    ${resp.content}    ${message}
    Delete All Sessions

specifiesWorkflowRunVersion
    [Arguments]    ${url}    ${namespace}    ${repository}    ${body}    ${message}    ${statuscode}
    ...    ${pipelineName}    ${version}
    Create Session    session    ${url}
    ${resp}=    Post Request    session    /pipeline/v1/${namespace}/${repository}/${pipelineName}?version=${version}    ${body}
    log    ${resp.status_code}
    log    ${resp.content}
    Should Be Equal As Strings    ${resp.status_code}    ${statuscode}
    ${json}=    To JSON    ${resp.content}
    log    ${json}
    Dictionary Should Contain Value    ${json}    ${message}
    ${values}    Get Dictionary Values    ${json}
    log    ${values}
    Delete All Sessions
